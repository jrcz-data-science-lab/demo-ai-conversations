services:
  ollama:
    build:
      context: ./app/ollama
    container_name: ollama
    ports:
      - "11434:11434"
    volumes:
      - ./app/ollama:/app
    networks:
      - ai_pipeline_net
    runtime: nvidia

  tts:
    build:
      context: ./app/tts
    container_name: tts
    ports:
      - "5000:5000"
    volumes:
      - ./app/tts:/usr/src/app
    devices:
      - "/dev/snd:/dev/snd"
    networks:
      - ai_pipeline_net

  faster_whisper:
    build:
      context: ./app/faster-whisper
    container_name: faster-whisper
    volumes:
      - ./app/faster-whisper:/app
    depends_on:
      - ollama
      - tts
    networks:
      - ai_pipeline_net
    environment:
      - PYTHONUNBUFFERED=1
    runtime: nvidia

  manager:
    build:
      context: ./app/manager
    container_name: manager
    ports:
      - "8000:8000"
    volumes:
      - ./app/manager:/usr/src/app
    depends_on:
      - ollama
      - tts
      - faster_whisper
    networks:
      - ai_pipeline_net
    environment:
      - PYTHONUNBUFFERED=1

networks:
  ai_pipeline_net:
    driver: bridge
